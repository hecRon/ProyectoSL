<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

<!-- DataSource -->
<bean class="org.springframework.jdbc.datasource.DriverManagerDataSource" destroy-method="close" name="dataSource">
	<property name="driverClassName" value="org.postgresql.Driver"/>
	<property name="url" value="jdbc:postgresql://localhost:5432/supermercadodb"/>
	<property name="username" value="postgres"/>
	<property name="password" value="placebo"/>
</bean>

<!-- sessionFactory -->
<bean class="org.springframework.orm.hibernate3.LocalSessionFactoryBean" name="sessionFactory">
	<property name="mappingResources">
		<list>
			<value>isima/supermercado/modelo/negocio/Departamento.hbm.xml</value>
			<value>isima/supermercado/modelo/negocio/Articulo.hbm.xml</value>
			<value>isima/supermercado/modelo/negocio/Usuario.hbm.xml</value>
			<value>isima/supermercado/modelo/negocio/Venta.hbm.xml</value>
		</list>
	</property>
	<property name="hibernateProperties">
		<props>
			<prop key="hibernate.dialect">org.hibernate.dialect.PostgreSQLDialect</prop>
			<prop key="hibernate.show_sql">true</prop>
			<prop key="hibernate.bytecode.use_reflection_optimizer">true</prop>
			<prop key="hibernate.cache.provider_class">org.hibernate.cache.HashtableCacheProvider</prop>
		</props>
	</property>
<property name="dataSource">
	<ref bean="dataSource"/>
</property>
</bean>

<!--jdbcExceptionTranslator-->
<bean class="org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator" name="jdbcExceptionTranslator">
	<property name= "dataSource">
		<ref bean="dataSource"/>
	</property>
</bean>

<!--hibernateTemplate-->
<bean class="org.springframework.orm.hibernate3.HibernateTemplate" name="hibernateTemplate">
	<property name="sessionFactory">
		<ref bean ="sessionFactory"/>
	</property>
	<property name="jdbcExceptionTranslator">
		<ref bean="jdbcExceptionTranslator"/>
	</property>
</bean>

<!--dao-->
<bean class="isima.supermercado.modelo.dao.hibernate.SupermercadoDAOHibernate" name="supermercadoDAO">
	<property name="hibernateTemplate">
		<ref bean="hibernateTemplate"/>
	</property>
</bean>

<!--TransactionManager-->
<bean class="org.springframework.orm.hibernate3.HibernateTransactionManager" name="transactionManager">
	<property name="sessionFactory">
		<ref bean="sessionFactory"/>
	</property>
</bean>

<!--Servicio Target-->
<bean class="isima.supermercado.controlador.servicio.implementacion.SupermercadoServicioImplementacion" name="supermercadoServicioTarget">
	<property name="supermercadoDAO">
		<ref bean="supermercadoDAO"/>
	</property>
</bean>

<!-- Bean Servicio -->
<bean class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean" name="supermercadoServicio">
	<property name="transactionManager">
		<ref bean="transactionManager"/>
	</property>
	<property name="target">
		<ref bean="supermercadoServicioTarget"/>
	</property>
	<property name="transactionAttributes">
		<props>
			<prop key="obtener*">PROPAGATION_REQUIRED,readOnly</prop>
			<prop key="registrar*">PROPAGATION_REQUIRED,-SupermercadoException</prop>
		</props>	
	</property>
</bean>

<!-- urlMapping -->
<bean class= "org.springframework.web.servlet.handler.SimpleUrlHandlerMapping" id="urlMapping">
	<property name= "interceptors">
		<list>
			<ref bean= "openSessionInViewInterceptor"/>
		</list>
	</property>
</bean> 

<!-- openSessionInViewInterceptor -->
<bean class= "org.springframework.orm.hibernate3.support.OpenSessionInViewInterceptor" name="openSessionInViewInterceptor">
	<property name="sessionFactory">
		<ref bean="sessionFactory"/>
	</property>
</bean>

</beans>
